{% extends 'base.html' %}

{% block title %}Movie Finder - –ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤{% endblock %}

{% block body %}
<div class="layout">
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –§–∏–ª—å—Ç—Ä—ã -->
    <aside class="sidebar">
        <!-- –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é -->
        <h4>–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é</h4>
        <div class="search-box">
            <input id="searchInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞...">
        </div>
        <button id="searchByNameBtn" class="search-btn" onclick="performSearch()">–ò—Å–∫–∞—Ç—å</button>

        <!-- –î–∏–∞–ø–∞–∑–æ–Ω –≥–æ–¥–æ–≤ -->
        <h4>–î–∏–∞–ø–∞–∑–æ–Ω –≥–æ–¥–æ–≤</h4>
        <div class="year-range-box">
            <input id="yearFrom" type="number" placeholder="–û—Ç" min="1900" max="2100">
            <input id="yearTo" type="number" placeholder="–î–æ" min="1900" max="2100">
            <select id="yearRangeGenre">
                <option value="">–í—Å–µ –∂–∞–Ω—Ä—ã</option>
            </select>
            <button id="searchByFiltersBtn" class="search-btn" onclick="searchByYearRange()">–ò—Å–∫–∞—Ç—å</button>
        </div>

        <!-- –ñ–∞–Ω—Ä—ã -->
        <h4>–ñ–∞–Ω—Ä—ã</h4>
        <div id="genresList" class="genres-list"></div>
        
    </aside>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ö–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="content">
        <!-- –ë–ª–æ–∫ "–ù–æ–≤–∏–Ω–∫–∏" -->
        <section class="content-section">
            <h2>üî• –ù–æ–≤–∏–Ω–∫–∏</h2>
            <div id="newMovies" class="movies-grid"></div>
        </section>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
        <section id="searchResults" class="content-section" style="display: none;">
            <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h2>
            <div id="moviesList" class="movies-grid"></div>
            
            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            <div id="pagination" class="pagination">
                <button id="prevBtn" onclick="previousPage()" disabled>–ù–∞–∑–∞–¥</button>
                <span id="pageInfo">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1</span>
                <button id="nextBtn" onclick="nextPage()">–í–ø–µ—Ä—ë–¥</button>
            </div>
        </section>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ -->
        <div id="loadingMessage" class="status-message loading" style="display: none;">
            <div class="loader"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
        </div>
        
        <div id="noResultsMessage" class="status-message no-results" style="display: none;">
            <p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã.</p>
        </div>
        
        <div id="errorMessage" class="status-message error" style="display: none;">
            <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>
            <button onclick="window.searchManager?.loadNewMovies()" class="retry-btn">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
        </div>
    </main>
</div>

<script>

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è onclick –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
function performSearch() {
    console.log('performSearch called, searchManager exists:', !!window.searchManager);
    
    if (!window.searchManager) {
        console.log('SearchManager not ready, waiting...');
        // Wait a bit and try again
        setTimeout(() => {
            console.log('Retry - searchManager exists:', !!window.searchManager);
            if (window.searchManager) {
                window.searchManager.searchByKeyword();
            } else {
                console.error('SearchManager still not available after delay');
            }
        }, 500);
        return;
    }
    
    window.searchManager.searchByKeyword();
}

function searchByYearRange() {
    if (window.searchManager) window.searchManager.searchByYearRange();
}

function previousPage() {
    if (window.searchManager) window.searchManager.previousPage();
}

function nextPage() {
    if (window.searchManager) window.searchManager.nextPage();
}
</script>
{% endblock %}
